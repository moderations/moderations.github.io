"use strict";(self["webpackChunklowcode"]=self["webpackChunklowcode"]||[]).push([[98],{7888:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var r=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticStyle:{padding:"20px 0"}},[t("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("新增")])],1),t("el-table",{attrs:{data:e.data}},[t("el-table-column",{attrs:{label:"Type",prop:"type"}}),t("el-table-column",{attrs:{label:"备注",prop:"remark"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function({row:n,index:r}){return[t("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onEdit(n,r)}}},[e._v("编辑")])]}}])})],1),t("el-dialog",{attrs:{visible:e.visible,title:"新增模板配置"},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"formInline",attrs:{model:e.formData,"label-width":"75px"}},[t("el-form-item",{attrs:{prop:"type",label:"Type",required:""}},[t("el-input",{attrs:{type:"text",placeholder:"请填写Type"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}})],1),t("el-form-item",{attrs:{prop:"remark",label:"备注",required:""}},[t("el-input",{attrs:{type:"text",placeholder:"请填写备注"},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onAddTemplate}},[e._v("保存")])],1)],1)],1)],1)},o=[],a=(n(4114),n(2751)),s={data(){return{columnData:[{title:"Type",key:"type"},{title:"备注",key:"remark"},{title:"操作",slot:"action",align:"center"}],data:[{type:1,remark:"闸机检票配置"}],visible:!1,loading:!1,formData:{type:"",remark:""}}},methods:{onEdit(e){const{type:t}=e;this.$router.push({name:"TemplateConfig",query:{type:t}})},onAdd(){this.visible=!0},async onAddTemplate(){const{formData:{type:e,remark:t},loading:n}=this;if(n)return this.$message.error({background:!0,message:"正在新增，请稍候"});this.loading=!0;const r=await(0,a.p)({type:e,remark:t,template:'[{"headerTitle":"","desc":"","child":[]}]'}).catch((e=>e));this.loading=!1,r&&200==r.code?(this.$message.success({background:!0,message:"新增表单模板成功"}),this.$router.push({name:"TemplateConfig",query:{type:e,remark:t}})):this.$message.error({background:!0,message:r&&(r.message||r.msg)||"新增表单模板出错"})}}},i=s,c=n(1656),l=(0,c.A)(i,r,o,!1,null,null,null),u=l.exports},2751:function(e,t,n){n.d(t,{h:function(){return c},p:function(){return i}});n(4114);const r={template:{name:"template",keyPath:"type",indexes:[{index:"type",unique:!0},"remark","template"]}};function o(e,t=1,n={}){return new Promise(((o,a)=>{const s=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;let i;const c=s.open(e,t);c.onsuccess=function(e){i=e.target.result,o(i)},c.onerror=function(e){a(e.message)},c.onupgradeneeded=function(t){i=t.target.result;const o=n.objectStore||e,a=i.createObjectStore(o,{keyPath:r[o].keyPath});r[o].indexes&&r[o].indexes.forEach((e=>{"string"===typeof e?a.createIndex(e,e,{unique:!1}):a.createIndex(e.index,e.index,{unique:e.unique})})),a.transaction.oncomplete=function(e){const t=i.transaction(o,"readwrite").objectStore(o);n&&n.data&&n.data.forEach((e=>{t.add(e)}))}}}))}function a(e,t,n,r="readonly"){return new Promise(((r,o)=>{console.log("getDataByKey key",n);var a=e.transaction([t]),s=a.objectStore(t),i=s.get(n);i.onerror=function(e){console.log("事务失败",e),o(e)},i.onsuccess=function(e){console.log("主键查询结果:",i.result),r(i.result)}}))}function s(e,t,n){return new Promise(((r,o)=>{var a=e.transaction([t],"readwrite").objectStore(t);const s=a.get(n.type);s.onerror=function(e){console.log("主键查询失败"),o({code:201,msg:e.message||"查询失败"})},s.onsuccess=function(e){var t=e.target.result||n;console.log("主键查询结果:",t),t.template=n.template;const s=a.put(t);s.onsuccess=function(e){console.log("数据更新成功"),r({code:200})},s.onerror=function(e){console.log("数据更新失败"),o({code:201,msg:e.message||"更新失败"})}}}))}function i(e){return new Promise((async(t,n)=>{const r=await o("template").catch((e=>e));if("string"===typeof r)return n({code:201,msg:r});if(r instanceof Error)return n({code:201,msg:r.message});const a=await s(r,"template",e).catch((e=>e));return a instanceof Error?n({code:201,msg:a.message}):t({code:200})}))}function c({type:e}={}){return new Promise((async(t,n)=>{const r=await o("template").catch((e=>e));if("string"===typeof r)return n({code:201,msg:r});if(r instanceof Error)return n({code:201,msg:r.message});const s=await a(r,"template",e).catch((e=>e));return s instanceof Error?n({code:201,msg:s.message}):t({code:200,data:JSON.parse(s.template)||[]})}))}}}]);
//# sourceMappingURL=template-list.615e84ec.js.map